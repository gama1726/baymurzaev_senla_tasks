# Bank Kafka System

Система банковских переводов на базе Kafka: продюсер генерирует сообщения о переводах, 3 реплики консюмера обрабатывают их из разных партиций одного топика.

## Запуск через Docker Compose

Из каталога `kafka_app`:

```bash
docker compose up -d
```

Поднимаются:
- **PostgreSQL** (порт 5432) — общая БД для продюсера и консюмеров
- **Zookeeper** (порт 2181)
- **3 брокера Kafka** (порты 9092, 9093, 9094)
- **bank-producer** — создаёт 1000 счетов при первом запуске (если таблица пуста), генерирует 5 сообщений о переводах в секунду
- **bank-consumer-1, bank-consumer-2, bank-consumer-3** — одна консюмер-группа `bank-consumer-group`, каждая реплика обрабатывает свою партицию

## Настройки Kafka

- Топик `bank-transfers`: 3 партиции, replication factor 3, retention 5 минут, min.insync.replicas=2
- Продюсер: exactly-once (транзакции), acks=all, ключ сообщения = id перевода (равномерное распределение по партициям)
- Консюмеры: batch-чтение, read_committed, одна группа — распределение партиций между 3 репликами

## Логи

- Продюсер: момент отправки каждого сообщения
- Консюмер: начало обработки, успешное завершение, ошибка валидации, ошибка транзакции (с записью перевода со статусом «завершилось с ошибкой»)
